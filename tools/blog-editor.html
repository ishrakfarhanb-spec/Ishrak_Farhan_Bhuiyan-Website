<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Blog Editor | Ishrak Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root {
        color-scheme: light;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f4f5f7;
        color: #111827;
        --brand: #2563eb;
        --border: #d1d5db;
      }
      body {
        margin: 0;
        padding: clamp(1.5rem, 3vw, 2.5rem);
      }
      h1 {
        margin-top: 0;
        font-size: clamp(1.75rem, 3vw, 2.1rem);
      }
      .layout {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: minmax(0, 1fr);
      }
      @media (min-width: 980px) {
        .layout {
          grid-template-columns: 1.2fr 0.9fr;
          align-items: start;
        }
      }
      section {
        background: #ffffff;
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: clamp(1.25rem, 3vw, 1.75rem);
        box-shadow: 0 18px 32px rgba(15, 23, 42, .08);
      }
      section > h2 {
        margin-top: 0;
        font-size: 1.25rem;
      }
      .posts-table {
        width: 100%;
        border-collapse: collapse;
        font-size: .95rem;
      }
      .posts-table th,
      .posts-table td {
        padding: .55rem .65rem;
        border-bottom: 1px solid #e5e7eb;
        vertical-align: top;
        text-align: left;
      }
      .posts-table th {
        font-size: .8rem;
        letter-spacing: .08em;
        text-transform: uppercase;
        color: #6b7280;
      }
      .posts-table tbody tr:last-child td {
        border-bottom: none;
      }
      .empty {
        padding: 1rem .5rem;
        color: #6b7280;
        font-size: .95rem;
        text-align: center;
      }
      label {
        display: grid;
        gap: .35rem;
        font-weight: 600;
        margin-bottom: .9rem;
        font-size: .9rem;
      }
      label small {
        font-weight: 400;
        color: #6b7280;
        font-size: .8rem;
      }
      input[type="text"],
      input[type="date"],
      textarea {
        border: 1px solid #d1d5db;
        border-radius: 10px;
        padding: .55rem .65rem;
        font: inherit;
        background: #fff;
        transition: border-color .2s ease, box-shadow .2s ease;
      }
      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, .15);
      }
      textarea {
        min-height: 160px;
        resize: vertical;
        line-height: 1.5;
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: .75rem;
        margin-top: 1.1rem;
      }
      button {
        border: none;
        border-radius: 999px;
        padding: .65rem 1.4rem;
        font: inherit;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: .4rem;
      }
      .btn-primary {
        background: var(--brand);
        color: #fff;
      }
      .btn-secondary {
        background: #e5e7eb;
        color: #111827;
      }
      .btn-danger {
        background: #f97316;
        color: #fff;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        padding: .2rem .6rem;
        background: rgba(37, 99, 235, .12);
        color: #1d4ed8;
        border-radius: 999px;
        font-size: .78rem;
        margin-right: .35rem;
      }
      .notice {
        font-size: .9rem;
        line-height: 1.55;
        color: #374151;
        display: grid;
        gap: .75rem;
      }
      code {
        font-family: ui-monospace, SFMono-Regular, "Roboto Mono", Menlo, Monaco, Consolas, monospace;
        background: #f3f4f6;
        padding: .2rem .4rem;
        border-radius: .35rem;
        font-size: .85rem;
      }
    </style>
  </head>
  <body>
    <h1>Blog Editor</h1>
    <p class="notice">
      <span>Fill in the form to add a new blog post. When you are ready, click <strong>Download updated blogs-data.js</strong> and replace the existing file inside <code>assets/js/blogs-data.js</code>.</span>
      <span>The body field expects normal text. Leave one blank line between paragraphs. Lines starting with <code>&gt;</code> become pull quotes. Lines starting with <code>-</code> create bullet lists.</span>
    </p>
    <div class="layout">
      <section>
        <h2>Current Posts</h2>
        <table class="posts-table" id="posts-table" aria-live="polite"></table>
        <div class="actions">
          <button class="btn-secondary" id="download-btn" type="button">Download updated blogs-data.js</button>
          <button class="btn-secondary" id="copy-btn" type="button">Copy data to clipboard</button>
        </div>
      </section>
      <section>
        <h2>Add / Edit Post</h2>
        <form id="post-form">
          <label>
            Post title
            <input type="text" id="title" required>
          </label>
          <label>
            Unique ID (lowercase-with-dashes)
            <input type="text" id="id" required pattern="[a-z0-9\\-]+">
            <small>Used for sorting and linking. Example: <code>cozy-minimalism</code>.</small>
          </label>
          <label>
            Kicker / eyebrow
            <input type="text" id="kicker">
          </label>
          <label>
            Summary (appears on card)
            <textarea id="summary" required></textarea>
          </label>
          <label>
            Author name
            <input type="text" id="author" value="Ishrak Farhan">
          </label>
          <label>
            Category
            <input type="text" id="category" required>
          </label>
          <label>
            Tags (comma separated)
            <input type="text" id="tags">
          </label>
          <label>
            Publish date
            <input type="date" id="date" required>
          </label>
          <label>
            Friendly date (optional)
            <input type="text" id="displayDate" placeholder="Jan 10, 2025">
          </label>
          <label>
            Image path
            <input type="text" id="image" placeholder="assets/img/Blog 02.png">
            <small>Save the preview image under <code>assets/img/</code> and reference it here.</small>
          </label>
          <label>
            Image alt text
            <input type="text" id="imageAlt">
          </label>
          <label>
            Hero badge (optional)
            <input type="text" id="heroBadge" placeholder="Featured">
          </label>
          <label>
            Body
            <textarea id="body" required placeholder="Write each paragraph normally.&#10;&#10;Blank lines create new paragraphs.&#10;Lines starting with &gt; turn into quotes.&#10;Lines starting with - create bullet points."></textarea>
          </label>
          <div class="actions">
            <button class="btn-primary" type="submit" id="save-post">Add/Update post</button>
            <button class="btn-danger" type="button" id="reset-form">Clear form</button>
          </div>
        </form>
      </section>
    </div>

    <script src="../assets/js/blogs-data.js"></script>
    <script>
      (function() {
        const table = document.getElementById('posts-table');
        const form = document.getElementById('post-form');
        const resetBtn = document.getElementById('reset-form');
        const downloadBtn = document.getElementById('download-btn');
        const copyBtn = document.getElementById('copy-btn');

        const fields = [
          'title', 'id', 'kicker', 'summary', 'author', 'category',
          'tags', 'date', 'displayDate', 'image', 'imageAlt', 'heroBadge', 'body'
        ];

        const state = {
          posts: Array.isArray(window.siteBlogs) ? cloneDeep(window.siteBlogs) : [],
          editIndex: null
        };

        function cloneDeep(value) {
          return JSON.parse(JSON.stringify(value));
        }

        function parseBody(raw) {
          if (!raw) return [];
          const lines = raw.replace(/\r\n/g, '\n').split('\n');
          const blocks = [];
          let current = [];
          lines.forEach(line => {
            if (!line.trim()) {
              flush();
              return;
            }
            current.push(line);
          });
          flush();

          function flush() {
            if (!current.length) return;
            blocks.push(current.join('\n'));
            current = [];
          }

          return blocks.map(block => {
            const trimmed = block.trim();
            if (!trimmed) return '';
            if (trimmed.startsWith('>')) {
              const text = trimmed.replace(/^>\s?/gm, '').trim();
              return { type: 'quote', text };
            }
            if (trimmed.startsWith('-')) {
              const items = trimmed.split('\n').map(line => line.replace(/^-\s*/, '').trim()).filter(Boolean);
              return { type: 'list', ordered: false, items };
            }
            return trimmed.replace(/\s+/g, ' ');
          }).filter(Boolean);
        }

        function stringifyBody(blocks) {
          if (!Array.isArray(blocks)) return '';
          return blocks.map(block => {
            if (!block) return '';
            if (typeof block === 'string') return block;
            if (block.type === 'quote') return '> ' + (block.text || '');
            if (block.type === 'list' && Array.isArray(block.items)) {
              return block.items.map(item => '- ' + item).join('\n');
            }
            return block.text || block.content || '';
          }).join('\n\n');
        }

        function renderTable() {
          if (!state.posts.length) {
            table.innerHTML = '<tbody><tr><td class="empty">No posts yet. Add one using the form.</td></tr></tbody>';
            return;
          }
          const rows = state.posts.map((post, index) => {
            const tags = (post.tags || []).map(tag => '<span class="pill">' + escapeHtml(tag) + '</span>').join('');
            return `
              <tr>
                <td><strong>${escapeHtml(post.title || '')}</strong><br><small>${escapeHtml(post.id || '')}</small></td>
                <td>${escapeHtml(post.category || '')}</td>
                <td>${escapeHtml(post.displayDate || post.date || '')}</td>
                <td>${tags || '<span class="pill" style="background:#e5e7eb;color:#374151;">No tags</span>'}</td>
                <td>
                  <button type="button" data-action="edit" data-index="${index}" class="btn-secondary">Edit</button>
                  <button type="button" data-action="delete" data-index="${index}" class="btn-danger" style="margin-top:4px;">Remove</button>
                </td>
              </tr>
            `;
          }).join('');
          table.innerHTML = `
            <thead>
              <tr>
                <th>Post</th>
                <th>Category</th>
                <th>Date</th>
                <th>Tags</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          `;

          table.querySelectorAll('button[data-action]').forEach(btn => {
            btn.addEventListener('click', handleRowAction);
          });
        }

        function handleRowAction(event) {
          const { action, index } = event.currentTarget.dataset;
          const idx = Number(index);
          if (Number.isNaN(idx)) return;

          if (action === 'edit') {
            populateForm(state.posts[idx], idx);
          } else if (action === 'delete') {
            if (confirm('Remove this post from the list?')) {
              state.posts.splice(idx, 1);
              state.editIndex = null;
              renderTable();
            }
          }
        }

        function populateForm(post, index) {
          state.editIndex = index;
          fields.forEach(field => {
            const el = document.getElementById(field);
            if (!el) return;
            if (field === 'tags') {
              el.value = (post.tags || []).join(', ');
            } else if (field === 'body') {
              el.value = stringifyBody(post.body);
            } else {
              el.value = post[field] || '';
            }
          });
          window.scrollTo({ top: form.offsetTop - 20, behavior: 'smooth' });
        }

        function resetForm() {
          form.reset();
          state.editIndex = null;
        }

        function escapeHtml(str) {
          return String(str || '').replace(/[&<>"']/g, char => ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
          })[char]);
        }

        function serializeForm(event) {
          event.preventDefault();
          const formData = new FormData(form);
          const post = {};
          fields.forEach(field => {
            let value = formData.get(field) || '';
            if (field === 'tags') {
              post.tags = value.split(',').map(tag => tag.trim()).filter(Boolean);
            } else if (field === 'body') {
              post.body = parseBody(value);
            } else if (value) {
              post[field] = value.trim();
            }
          });
          if (!post.displayDate && post.date) {
            const date = new Date(post.date);
            if (!isNaN(date)) {
              post.displayDate = date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
              });
            }
          }
          if (!post.author) post.author = 'Ishrak Farhan';

          if (state.editIndex !== null) {
            state.posts[state.editIndex] = post;
          } else {
            state.posts.push(post);
          }
          resetForm();
          renderTable();
        }

        function buildFileContents() {
          const contents = 'window.siteBlogs = ' + JSON.stringify(state.posts, null, 2) + ';\n';
          return contents;
        }

        function downloadFile() {
          if (!state.posts.length) {
            alert('Add at least one post before downloading.');
            return;
          }
          const blob = new Blob([buildFileContents()], { type: 'application/javascript' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'blogs-data.js';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
          if (!navigator.clipboard) {
            alert('Clipboard access is not available in this browser.');
            return;
          }
          navigator.clipboard.writeText(buildFileContents())
            .then(() => alert('Copied! Paste this into assets/js/blogs-data.js to publish.'))
            .catch(() => alert('Unable to copy. Try the download button instead.'));
        }

        form.addEventListener('submit', serializeForm);
        resetBtn.addEventListener('click', resetForm);
        downloadBtn.addEventListener('click', downloadFile);
        copyBtn.addEventListener('click', copyToClipboard);

        renderTable();
      })();
    </script>
  </body>
</html>
